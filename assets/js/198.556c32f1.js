(window.webpackJsonp=window.webpackJsonp||[]).push([[198],{488:function(a,e,s){"use strict";s.r(e);var t=s(10),n=Object(t.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("[TOC]")]),a._v(" "),e("h1",{attrs:{id:"week2-脚手架架构设计和框架搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#week2-脚手架架构设计和框架搭建"}},[a._v("#")]),a._v(" Week2 脚手架架构设计和框架搭建")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://www.imooc.com/wiki/weban/week1a.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("前端架构师-电子书"),e("OutboundLink")],1)]),a._v(" "),e("h2",{attrs:{id:"本周导学"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本周导学"}},[a._v("#")]),a._v(" 本周导学")]),a._v(" "),e("h3",{attrs:{id:"将收获什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#将收获什么"}},[a._v("#")]),a._v(" 将收获什么")]),a._v(" "),e("ul",[e("li",[a._v("脚手架的实现原理")]),a._v(" "),e("li",[a._v("Lerna的常见用法")]),a._v(" "),e("li",[a._v("架构设计技巧和架构图绘制方法")])]),a._v(" "),e("h3",{attrs:{id:"主要内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主要内容"}},[a._v("#")]),a._v(" 主要内容")]),a._v(" "),e("ul",[e("li",[a._v("学习如何以架构师的角度思考基础架构问题")]),a._v(" "),e("li",[a._v("多Package项目管理痛点和解决方案，基于Lerna脚手架框架搭建")]),a._v(" "),e("li",[a._v("imooc-cli脚手架需求分析和架构设计、架构设计图")])]),a._v(" "),e("h3",{attrs:{id:"附赠内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附赠内容"}},[a._v("#")]),a._v(" 附赠内容")]),a._v(" "),e("ul",[e("li",[a._v("脚手架调试技巧")]),a._v(" "),e("li",[a._v("Lerna源码分析（Node的module模块分析、yargs使用方法、剖析Lerna架构设计）")])]),a._v(" "),e("h3",{attrs:{id:"关键词"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关键词"}},[a._v("#")]),a._v(" 关键词")]),a._v(" "),e("ul",[e("li",[a._v("脚手架 - 掌握脚手架原理和开发全流程")]),a._v(" "),e("li",[a._v("Lerna - 解决多Package项目管理痛点")]),a._v(" "),e("li",[a._v("架构设计 - 学习大厂基础基础架构设计思路")])]),a._v(" "),e("h3",{attrs:{id:"学习方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#学习方法"}},[a._v("#")]),a._v(" 学习方法")]),a._v(" "),e("ul",[e("li",[e("strong",[a._v("架构三部曲：掌握原理 -> 独立思考 -> 总结反思")])]),a._v(" "),e("li",[a._v("深度剖析优秀开源项目，由表及里，由浅入深")]),a._v(" "),e("li",[e("strong",[a._v("视角切换：多切换到架构师视角，从全局思考问题")])])]),a._v(" "),e("h3",{attrs:{id:"注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[a._v("#")]),a._v(" 注意事项")]),a._v(" "),e("ul",[e("li",[a._v("整体难度不高，不用担心学不会，坚持打卡写心得")]),a._v(" "),e("li",[a._v("优秀的程序猿不止能够实现功能，更多读懂别人的代码，读懂别人的想法")]),a._v(" "),e("li",[a._v("从知名的开源项目中汲取养分，为我所用，助我成长")])]),a._v(" "),e("h3",{attrs:{id:"前端脚手架imooc-cli核心功能演示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端脚手架imooc-cli核心功能演示"}},[a._v("#")]),a._v(" 前端脚手架imooc-cli核心功能演示")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" i "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-g")]),a._v(" @imooc-cli/core\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"_1、站在前端研发的视角-分析开发脚手架的必要性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、站在前端研发的视角-分析开发脚手架的必要性"}},[a._v("#")]),a._v(" 1、站在前端研发的视角，分析开发脚手架的必要性")]),a._v(" "),e("h3",{attrs:{id:"研发效能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#研发效能"}},[a._v("#")]),a._v(" 研发效能")]),a._v(" "),e("p",[e("strong",[a._v("开发脚手架的核心目标是：提升前端研发效能")])]),a._v(" "),e("p",[a._v("大厂研发架构图：")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://oss-1252175178.cos.ap-shanghai.myqcloud.com/%E6%85%95%E8%AF%BE%E7%BD%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%AF%BE%E7%A8%8B/%E5%A4%A7%E5%8E%82%E7%A0%94%E5%8F%91%E6%9E%B6%E6%9E%84%E5%9B%BE.png",alt:""}})]),a._v(" "),e("h3",{attrs:{id:"脚手架核心价值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#脚手架核心价值"}},[a._v("#")]),a._v(" 脚手架核心价值")]),a._v(" "),e("p",[a._v("将研发过程：")]),a._v(" "),e("ul",[e("li",[a._v("自动化：项目重复代码拷贝/git操作/发布上线操作")]),a._v(" "),e("li",[a._v("标准化：项目创建/git flow/发布流程/回滚流程")]),a._v(" "),e("li",[a._v("数据化：研发过程系统化、数据化，使得研发过程可量化")])]),a._v(" "),e("h3",{attrs:{id:"和自动化构建工具区别"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#和自动化构建工具区别"}},[a._v("#")]),a._v(" 和自动化构建工具区别")]),a._v(" "),e("blockquote",[e("p",[a._v("问题：jenkins、travis等自动化构建工具已经比较成熟了，为什么还需要自研脚手架？")])]),a._v(" "),e("ul",[e("li",[a._v("不满足需求：jenkins、travis通常在git hooks中触发，需要在服务端执行，无法覆盖研发人员本地的功能，如：创建项目自动化、本地git操作自动化等")]),a._v(" "),e("li",[a._v("定制复杂：jenkins、travis定制过程需要开发插件，其过程较为复杂，需要使用Java语言，对前端同学不够友好")])]),a._v(" "),e("h2",{attrs:{id:"_2、从使用角度理解什么是脚手架"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、从使用角度理解什么是脚手架"}},[a._v("#")]),a._v(" 2、从使用角度理解什么是脚手架？")]),a._v(" "),e("h3",{attrs:{id:"脚手架简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#脚手架简介"}},[a._v("#")]),a._v(" 脚手架简介")]),a._v(" "),e("blockquote",[e("p",[a._v("脚手架本质是一个操作系统的客户端，它通过命令行执行。")])]),a._v(" "),e("p",[a._v("比如：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("vue create vue-test-app\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("上面这条命令由 3 个部分组成：")]),a._v(" "),e("ul",[e("li",[a._v("主命令: vue")]),a._v(" "),e("li",[a._v("command: create")]),a._v(" "),e("li",[a._v("command 的 param: vue-test-app")])]),a._v(" "),e("p",[a._v("它表示创建一个 vue 项目，项目的名称为 vue-test-app，以上是最一个较为简单的脚手架命令。")]),a._v(" "),e("h3",{attrs:{id:"脚手架的执行原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#脚手架的执行原理"}},[a._v("#")]),a._v(" 脚手架的执行原理")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://oss-1252175178.cos.ap-shanghai.myqcloud.com/%E6%85%95%E8%AF%BE%E7%BD%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%AF%BE%E7%A8%8B/%E8%84%9A%E6%89%8B%E6%9E%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86.jpeg",alt:""}})]),a._v(" "),e("p",[a._v("脚手架的执行原理如下：")]),a._v(" "),e("ul",[e("li",[a._v("在终端输入 vue create vue-test-app")]),a._v(" "),e("li",[a._v("终端解析出 vue 命令")]),a._v(" "),e("li",[a._v("终端在环境变量中找到 vue 命令")]),a._v(" "),e("li",[a._v("终端根据 vue 命令链接到实际文件 vue.js")]),a._v(" "),e("li",[a._v("终端利用 node 执行 vue.js")]),a._v(" "),e("li",[a._v("vue.js 解析 command / options")]),a._v(" "),e("li",[a._v("vue.js 执行 command")]),a._v(" "),e("li",[a._v("执行完毕，退出执行")])]),a._v(" "),e("h2",{attrs:{id:"_3、脚手架的实现原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、脚手架的实现原理"}},[a._v("#")]),a._v(" 3、脚手架的实现原理")]),a._v(" "),e("p",[a._v("问题：")]),a._v(" "),e("ol",[e("li",[a._v("全局安装 "),e("code",[a._v("@vue/cli")]),a._v(" 时发生了什么？\n"),e("ul",[e("li",[a._v("将 "),e("code",[a._v("@vue/cli")]),a._v(" 安装到 "),e("code",[a._v("node/lib/node_module")]),a._v(" 中")]),a._v(" "),e("li",[a._v("创建软链 "),e("code",[a._v("vue")]),a._v(" 链接到 "),e("code",[a._v("@vue/cli")]),a._v(" 项目中的 "),e("code",[a._v("bin/vue.js")]),a._v(" （在终端中使用 "),e("code",[a._v("which vue")]),a._v(" 查看）")])])]),a._v(" "),e("li",[a._v("在终端执行 "),e("code",[a._v("vue create vue-test-app")]),a._v(" 时发生了什么？\n"),e("ul",[e("li",[a._v("终端解析出 vue 命令")]),a._v(" "),e("li",[a._v("终端在环境变量中找到 vue 命令")]),a._v(" "),e("li",[a._v("终端根据 vue 命令链接到实际文件 vue.js")]),a._v(" "),e("li",[a._v("终端利用 node 执行 vue.js")])])])]),a._v(" "),e("p",[a._v("脚手架执行的全过程：")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://oss-1252175178.cos.ap-shanghai.myqcloud.com/%E6%85%95%E8%AF%BE%E7%BD%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%AF%BE%E7%A8%8B/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%8E%9F%E7%90%86%E8%BF%9B%E9%98%B6.png",alt:""}})]),a._v(" "),e("h2",{attrs:{id:"_4、脚手架的开发流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、脚手架的开发流程"}},[a._v("#")]),a._v(" 4、脚手架的开发流程")]),a._v(" "),e("h3",{attrs:{id:"开发流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开发流程"}},[a._v("#")]),a._v(" 开发流程")]),a._v(" "),e("ol",[e("li",[a._v("创建项目，并初始化 npm")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" jay-cli-demo "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建项目目录")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" jay-cli-demo "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入目录")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" init "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 初始化npm")]),a._v("\ncode "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用vscode打开项目")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[a._v("新建bin目录，并在目录下新增index.js文件，做为脚手架入口文件（注意要再最上方添加一行代码，用于查找当前使用环境下的node）：")])]),a._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token hashbang comment"}},[a._v("#!/usr/bin/env node")]),a._v("\n\nconsole"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v("'welcome to jay-cli-demo'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("ol",{attrs:{start:"3"}},[e("li",[a._v("配置 package.json，添加 bin 属性")])]),a._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"jay-cli-demo"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"version"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.0.0"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"description"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"bin"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"jay-test"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"bin/index.js"')]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"main"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"index.js"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"scripts"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"test"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"echo \\"Error: no test specified\\" && exit 1"')]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"keywords"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"author"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('""')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  "),e("span",{pre:!0,attrs:{class:"token string-property property"}},[a._v('"license"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ISC"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[a._v("将脚手架发布到 npm（发布过程中遇到问题请请参考网上的发布文章）")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" publish "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 发布到npm")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("blockquote",[e("p",[a._v("注意，因为npm不允许出现重复的包名，因此需要将上一步中 package.json 中的 name 从 "),e("code",[a._v("jay-cli-demo")]),a._v(" 改为 "),e("a",{attrs:{href:"https://www.npmjs.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("npmjs.com"),e("OutboundLink")],1),a._v("  上未被占用的名字。")])]),a._v(" "),e("h3",{attrs:{id:"使用流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用流程"}},[a._v("#")]),a._v(" 使用流程")]),a._v(" "),e("ol",[e("li",[a._v("安装脚手架")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-g")]),a._v(" jay-cli-demo\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[a._v("使用脚手架")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("jay-test\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# welcome to jay-cli-demo")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h3",{attrs:{id:"开发难点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开发难点"}},[a._v("#")]),a._v(" 开发难点")]),a._v(" "),e("ul",[e("li",[a._v("分包：将复杂的系统拆分成若干个模块")]),a._v(" "),e("li",[a._v("命令注册")]),a._v(" "),e("li",[a._v("参数解析")])]),a._v(" "),e("p",[a._v("还有很多，比如：")]),a._v(" "),e("ul",[e("li",[a._v("命令行交互")]),a._v(" "),e("li",[a._v("日志打印")]),a._v(" "),e("li",[a._v("命令行文字变色")]),a._v(" "),e("li",[a._v("网络通信：HTTP/WebSocket")]),a._v(" "),e("li",[a._v("文件处理")])]),a._v(" "),e("h3",{attrs:{id:"本地调试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本地调试"}},[a._v("#")]),a._v(" 本地调试")]),a._v(" "),e("p",[a._v("以 "),e("code",[a._v("jay-cli-test")]),a._v(" 为例")]),a._v(" "),e("p",[e("strong",[a._v("方法一：在项目目录下使用 "),e("code",[a._v("npm link")]),a._v("：")])]),a._v(" "),e("ul",[e("li",[a._v("在 "),e("code",[a._v(".nvm/versions/node/v14.15.4/lib/node_modules")]),a._v(" 目录中，会创建一个 "),e("code",[a._v("jay-cli-test")]),a._v(" 软链,链接到项目目录")]),a._v(" "),e("li",[a._v("运行 "),e("code",[a._v("jay-cli-test")]),a._v(" 即运行项目目录中 "),e("code",[a._v("package.json")]),a._v(" 中的 "),e("code",[a._v("bin")]),a._v(" 配置命令")])]),a._v(" "),e("p",[e("strong",[a._v("方法二：在项目目录的父级下使用 "),e("code",[a._v("npm i jay-cli-test -g")])])]),a._v(" "),e("ul",[e("li",[a._v("npm 会默认给我们创建一个软链，效果同上")]),a._v(" "),e("li",[a._v("如果希望删除这个软链，使用npm线上版本，可以在这个项目目录的非父级目录下，再来一次 "),e("code",[a._v("npm i jay-cli-test -g")]),a._v(" 即可。")])]),a._v(" "),e("p",[a._v("分包情况：以 "),e("code",[a._v("jay-cli-test-lib")]),a._v(" 为例。")]),a._v(" "),e("h3",{attrs:{id:"本地link标准流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本地link标准流程"}},[a._v("#")]),a._v(" 本地link标准流程")]),a._v(" "),e("p",[a._v("链接本地脚手架：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" your-cli-dir\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("link")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("p",[a._v("链接本地库文件：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" your-lib-dir\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("link")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" your-cli-dir\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("link")]),a._v(" your-lib\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("取消链接本地库文件：")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除主项目对库文件的软链")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" your-cli-dir\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" unlink your-lib\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除库文件的本地软链")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" your-lib-dir\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" unlink\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除主项目的软链")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" your-cli-dir\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" unlink\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 当遇到库文件link不存在的情况时，可尝试下面的方式解决")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rf")]),a._v(" node_modules\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-S")]),a._v(" your-lib\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br")])]),e("p",[a._v("理解 "),e("code",[a._v("npm link")]),a._v("：")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("npm link your-lib")]),a._v("：将当前项目中 "),e("code",[a._v("node_modules")]),a._v(" 下指定的库文件链接到 "),e("code",[a._v("node")]),a._v(" 全局 "),e("code",[a._v("node_modules")]),a._v(" 下的库文件")]),a._v(" "),e("li",[e("code",[a._v("npm link")]),a._v("：将当前项目链接到 "),e("code",[a._v("node")]),a._v(" 全局 "),e("code",[a._v("node_modules")]),a._v(" 中作为一个库文件，并解析 "),e("code",[a._v("bin")]),a._v(" 配置创建可执行文件")])]),a._v(" "),e("p",[a._v("理解 "),e("code",[a._v("npm unlink")]),a._v("：")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("npm unlink")]),a._v("：将当前项目从 "),e("code",[a._v("node")]),a._v(" 全局 "),e("code",[a._v("node_modules")]),a._v(" 中移除")]),a._v(" "),e("li",[e("code",[a._v("npm unlink your-lib")]),a._v("：将当前项目中的库文件依赖移除")])]),a._v(" "),e("p",[a._v("注意，使用 "),e("code",[a._v("nvm")]),a._v(" 管理 npm 后情况稍有不同：")]),a._v(" "),e("ul",[e("li",[a._v("全局 "),e("code",[a._v("node_modules")]),a._v(" 目录为："),e("code",[a._v("/Users/aaron/.nvm/versions/node/v14.15.4/lib/node_modules")])]),a._v(" "),e("li",[a._v("bin 目录为："),e("code",[a._v("/Users/aaron/.nvm/versions/node/v14.15.4/bin")])]),a._v(" "),e("li",[a._v("bin 目录中的指令指向全局 "),e("code",[a._v("node_modules")]),a._v(" 中的依赖")])]),a._v(" "),e("h3",{attrs:{id:"产出测试脚手架-jay-test-cli"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#产出测试脚手架-jay-test-cli"}},[a._v("#")]),a._v(" 产出测试脚手架 — jay-test-cli")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://gitee.com/AaronKong/jay-test",target:"_blank",rel:"noopener noreferrer"}},[a._v("代码地址"),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("npm包：")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.npmjs.com/package/jay-test-cli",target:"_blank",rel:"noopener noreferrer"}},[a._v("jay-test-cli"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://www.npmjs.com/package/jay-test-cli-lib",target:"_blank",rel:"noopener noreferrer"}},[a._v("jay-test-cli-lib"),e("OutboundLink")],1)])]),a._v(" "),e("p",[a._v("使用方式：")]),a._v(" "),e("ol",[e("li",[a._v("安装： "),e("code",[a._v("npm i jay-test-cli -g")])]),a._v(" "),e("li",[a._v("运行： "),e("code",[a._v("jay-test-cli -V")])])]),a._v(" "),e("h2",{attrs:{id:"_5、lerna简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、lerna简介"}},[a._v("#")]),a._v(" 5、Lerna简介")]),a._v(" "),e("h3",{attrs:{id:"原生脚手架开发痛点分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#原生脚手架开发痛点分析"}},[a._v("#")]),a._v(" 原生脚手架开发痛点分析")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("痛点一：重复操作")]),a._v(" "),e("ul",[e("li",[a._v("多 Package 本地 link")]),a._v(" "),e("li",[a._v("多 Package 依赖安装")]),a._v(" "),e("li",[a._v("多 Package 单元测试")]),a._v(" "),e("li",[a._v("多 Package 代码提交")]),a._v(" "),e("li",[a._v("多 Package 代码发布")])])]),a._v(" "),e("li",[e("p",[a._v("痛点二：版本一致性")]),a._v(" "),e("ul",[e("li",[a._v("发布时版本一致性")]),a._v(" "),e("li",[a._v("发布后相互依赖版本升级")])])])]),a._v(" "),e("blockquote",[e("p",[a._v("package 越多，管理复杂度越高")])]),a._v(" "),e("h3",{attrs:{id:"lerna简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lerna简介"}},[a._v("#")]),a._v(" Lerna简介")]),a._v(" "),e("blockquote",[e("p",[a._v("Lerna is a tool that optimizes the workflow around managing multi-package repositories with git and npm.")]),a._v(" "),e("p",[e("strong",[a._v("Lerna 是一个优化基于 git+npm 的多 package 项目的管理工具")])])]),a._v(" "),e("p",[e("strong",[a._v("优势")])]),a._v(" "),e("ul",[e("li",[a._v("大幅减少重复操作")]),a._v(" "),e("li",[a._v("提升操作的标准化")])]),a._v(" "),e("blockquote",[e("p",[a._v("Lerna 是架构优化的产物，它揭示了一个架构真理：项目复杂度提升后，就需要对项目进行架构优化。架构优化的主要目标往往都是以效能为核心。")])]),a._v(" "),e("p",[e("strong",[a._v("官网")]),a._v(" "),e("a",{attrs:{href:"https://lerna.js.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://lerna.js.org/"),e("OutboundLink")],1)]),a._v(" "),e("p",[e("strong",[a._v("案例")]),a._v("\n使用 Lerna 管理的大型项目：")]),a._v(" "),e("ul",[e("li",[a._v("babel: "),e("a",{attrs:{href:"https://github.com/babel/babel",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/babel/babel"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("vue-cli: "),e("a",{attrs:{href:"https://github.com/vuejs/vue-cli",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/vuejs/vue-cli"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("s",[a._v("create-react-app: "),e("a",{attrs:{href:"https://github.com/facebook/create-react-app",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/facebook/create-react-app"),e("OutboundLink")],1)])])]),a._v(" "),e("p",[e("strong",[a._v("lerna 开发脚手架流程（划重点）")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://oss-1252175178.cos.ap-shanghai.myqcloud.com/%E6%85%95%E8%AF%BE%E7%BD%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%AF%BE%E7%A8%8B/lerna%20%E5%BC%80%E5%8F%91%E8%84%9A%E6%89%8B%E6%9E%B6%E6%B5%81%E7%A8%8B.png",alt:""}})]),a._v(" "),e("h3",{attrs:{id:"lerna-命令介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lerna-命令介绍"}},[a._v("#")]),a._v(" Lerna 命令介绍")]),a._v(" "),e("p",[a._v("参考"),e("a",{attrs:{href:"https://github.com/lerna/lerna",target:"_blank",rel:"noopener noreferrer"}},[a._v("官网"),e("OutboundLink")],1)]),a._v(" "),e("ul",[e("li",[a._v("lerna init\n"),e("ul",[e("li",[a._v("描述：初始化 lerna 项目，添加 "),e("code",[a._v("lerna.json")]),a._v(" 和 "),e("code",[a._v("packages")]),a._v(" 目录")]),a._v(" "),e("li",[a._v("示例："),e("code",[a._v("lerna init")])])])]),a._v(" "),e("li",[a._v("lerna create\n"),e("ul",[e("li",[a._v("描述：创建packages包")]),a._v(" "),e("li",[a._v("示例："),e("code",[a._v("lerna create core")])])])]),a._v(" "),e("li",[a._v("lerna add\n"),e("ul",[e("li",[a._v("描述：对所有packages包，安装依赖，也可单独给某个packages包安装依赖")]),a._v(" "),e("li",[a._v("示例："),e("code",[a._v("lerna add lodash")]),a._v(" "),e("code",[a._v("lerna add lodash packages/core/")])])])]),a._v(" "),e("li",[a._v("lerna link\n"),e("ul",[e("li",[a._v("描述：自动添加packages包之间的软链（如果有依赖关系的话）")]),a._v(" "),e("li",[a._v("示例："),e("code",[a._v("lerna link")])])])]),a._v(" "),e("li",[a._v("lerna clean\n"),e("ul",[e("li",[a._v("描述：对所有packages包，删除其中的 "),e("code",[a._v("node_modules")])]),a._v(" "),e("li",[a._v("示例："),e("code",[a._v("lerna clean")])])])]),a._v(" "),e("li",[a._v("lerna bootstrap\n"),e("ul",[e("li",[a._v("描述：给所有packages包，安装依赖，等同于cd 到每个包中，执行 "),e("code",[a._v("npm i")])]),a._v(" "),e("li",[a._v("示例："),e("code",[a._v("lerna bootstrap")])])])]),a._v(" "),e("li",[a._v("lerna exec\n"),e("ul",[e("li",[a._v("描述：对所有packages包，执行shell脚本，也可单独对某个包执行")]),a._v(" "),e("li",[a._v("示例：\n"),e("ul",[e("li",[e("code",[a._v("lerna exec -- rm -rf node_modules")])]),a._v(" "),e("li",[e("code",[a._v("lerna exec --scope @jay-cli-dev/core -- rm -rf node_modules")])])])])])]),a._v(" "),e("li",[a._v("lerna run\n"),e("ul",[e("li",[a._v("描述：对所有packages包，运行某条命令")]),a._v(" "),e("li",[a._v("示例：\n"),e("ul",[e("li",[e("code",[a._v("lerna run test")])]),a._v(" "),e("li",[e("code",[a._v("lerna run --scope @jay-cli-dev/utils test")])])])])])]),a._v(" "),e("li",[a._v("lerna version")]),a._v(" "),e("li",[a._v("lerna diff")]),a._v(" "),e("li",[a._v("lerna publish")])]),a._v(" "),e("h2",{attrs:{id:"_6、lerna源码分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6、lerna源码分析"}},[a._v("#")]),a._v(" 6、Lerna源码分析")]),a._v(" "),e("h3",{attrs:{id:"【讨论题】谈一谈-node和web的事件循环-eventloop-机制的异同"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#【讨论题】谈一谈-node和web的事件循环-eventloop-机制的异同"}},[a._v("#")]),a._v(" 【讨论题】谈一谈 Node和Web的事件循环（EventLoop）机制的异同")]),a._v(" "),e("ul",[e("li",[a._v("运行机制基本类似：\n"),e("ul",[e("li",[a._v("Web 的宏任务如 "),e("code",[a._v("setTimeout")]),a._v(" 、"),e("code",[a._v("Ajax")]),a._v(" ，主要交由对应的 Web API 处理，然后回调函数交由 V8 引擎处理")]),a._v(" "),e("li",[a._v("Node 的宏任务如 "),e("code",[a._v("setTimeout")]),a._v("、"),e("code",[a._v("fs.readFile")]),a._v(" 等 Node API 则主要是由跨平台异步IO库 "),e("code",[a._v("libuv")]),a._v(" 处理，然后回调函数交由 V8 引擎处理")])])]),a._v(" "),e("li",[a._v("Node 中多了 process.nextTick 和 setImmediate，两者都提供的是异步能力\n"),e("ul",[e("li",[a._v("process.nextTick 是微任务")]),a._v(" "),e("li",[a._v("setImmediate 是宏任务")])])]),a._v(" "),e("li",[a._v("Node.js的Event Loop跟浏览器的Event Loop不一样，他是分阶段的")]),a._v(" "),e("li",[e("code",[a._v("setImmediate")]),a._v(" 和 "),e("code",[a._v("setTimeout(fn, 0)")]),a._v(" 哪个回调先执行，需要看他们本身在哪个阶段注册的，如果在定时器回调或者I/O回调里面，"),e("code",[a._v("setImmediate")]),a._v(" 肯定先执行。如果在最外层或者 "),e("code",[a._v("setImmediate")]),a._v(" 回调里面，哪个先执行取决于当时机器状况。")]),a._v(" "),e("li",[e("code",[a._v("process.nextTick")]),a._v(" 不在Event Loop的任何阶段，他是一个特殊API，他会立即执行，然后才会继续执行Event Loop")])]),a._v(" "),e("p",[a._v("参考资料：")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2014/10/event-loop.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("JavaScript 运行机制详解：再谈Event Loop"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://juejin.cn/post/6844904100195205133",target:"_blank",rel:"noopener noreferrer"}},[a._v("setTimeout和setImmediate到底谁先执行，本文让你彻底理解Event Loop"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://nodejs.org/zh-cn/docs/guides/event-loop-timers-and-nexttick/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Node.js 事件循环，定时器和 process.nextTick()"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/80458653",target:"_blank",rel:"noopener noreferrer"}},[a._v("正确理解 Node.js 的 Event loop"),e("OutboundLink")],1)])]),a._v(" "),e("h2",{attrs:{id:"_7、基于lerna重新设计jl"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7、基于lerna重新设计jl"}},[a._v("#")]),a._v(" 7、基于Lerna重新设计JL")]),a._v(" "),e("p",[a._v("JL中新增：")]),a._v(" "),e("ul",[e("li",[a._v("熟悉Yargs脚手架开发框架")]),a._v(" "),e("li",[a._v("熟悉多Package管理工具Lerna的使用方法和实现原理")]),a._v(" "),e("li",[a._v("深入理解Node.js模块路径解析流程")])]),a._v(" "),e("h3",{attrs:{id:"yargs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#yargs"}},[a._v("#")]),a._v(" yargs")]),a._v(" "),e("ul",[e("li",[a._v("脚手架构成\n"),e("ul",[e("li",[a._v("bin：package.json中配置bin属性，npm link 本地安装")]),a._v(" "),e("li",[a._v("command：命令")]),a._v(" "),e("li",[a._v("options：参数（boolean/string/number）")]),a._v(" "),e("li",[a._v("文件顶部增加 "),e("code",[a._v("#!/usr/bin/env node")])])])]),a._v(" "),e("li",[a._v("脚手架-"),e("strong",[a._v("初始化")]),a._v("流程\n"),e("ul",[e("li",[a._v("构造函数：Yargs()")]),a._v(" "),e("li",[a._v("常用方法：\n"),e("ul",[e("li",[e("strong",[a._v("Yargs.options")])]),a._v(" "),e("li",[a._v("Yargs.option")]),a._v(" "),e("li",[e("strong",[a._v("Yargs.group")])]),a._v(" "),e("li",[a._v("Yargs.demandCommand")]),a._v(" "),e("li",[a._v("Yargs.recommendCommands")]),a._v(" "),e("li",[a._v("Yargs.strict")]),a._v(" "),e("li",[e("strong",[a._v("Yargs.fail")])]),a._v(" "),e("li",[a._v("Yargs.alias")]),a._v(" "),e("li",[a._v("Yargs.wrap")]),a._v(" "),e("li",[a._v("Yargs.epilogue")])])])])]),a._v(" "),e("li",[a._v("脚手架-"),e("strong",[a._v("参数解析")]),a._v("方法\n"),e("ul",[e("li",[e("strong",[a._v("hideBin")]),a._v("(process.argv) / Yargs.argv")]),a._v(" "),e("li",[e("strong",[a._v("Yargs.parse(argv, options)")])])])]),a._v(" "),e("li",[a._v("脚手架-"),e("strong",[a._v("命令注册")]),a._v("方法\n"),e("ul",[e("li",[e("strong",[a._v("Yargs.command(command, describe, builder, handler)")])]),a._v(" "),e("li",[e("strong",[a._v("Yargs.command({ command, describe, builder, handler })")])])])])]),a._v(" "),e("h3",{attrs:{id:"lerna"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lerna"}},[a._v("#")]),a._v(" Lerna")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("Lerna 是基于 git+npm 的多package项目管理工具，提供了一系列的命令来降低多包项目的管理成本，如：")]),a._v(" "),e("ul",[e("li",[a._v("lerna init 初始化")]),a._v(" "),e("li",[a._v("lerna create 创建包")]),a._v(" "),e("li",[a._v("lerna add 安装依赖")]),a._v(" "),e("li",[a._v("lerna exec 执行脚本")]),a._v(" "),e("li",[a._v("lerna run 执行命令")])])]),a._v(" "),e("li",[e("p",[a._v("实现原理")]),a._v(" "),e("ul",[e("li",[a._v("通过 import-local 优先调用本地 lerna 命令")]),a._v(" "),e("li",[a._v("通过 Yargs 生成脚手架，先注册全局属性，再注册命令，最后通过 parse 方法解析参数")]),a._v(" "),e("li",[a._v("lerna 命令注册时需要传入 builder 和 handler 两个方法，builder 方法用于注册命令专属的 options，handler 用来处理命令的业务逻辑")]),a._v(" "),e("li",[e("strong",[a._v("lerna 通过配置 npm 本地依赖的方式来进行本地开发")]),a._v("，具体写法是在 package.json 的依赖中写入："),e("code",[a._v("file:your-local-module-path")]),a._v(" ，在 lerna publish 时会自动将该路径替换")])])])]),a._v(" "),e("h3",{attrs:{id:"node-js-模块路径解析流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#node-js-模块路径解析流程"}},[a._v("#")]),a._v(" Node.js 模块路径解析流程")]),a._v(" "),e("ul",[e("li",[a._v("Node.js 项目模块路径解析是通过 "),e("code",[a._v("require.resolve")]),a._v(" 方法来实现的")]),a._v(" "),e("li",[e("code",[a._v("require.resolve")]),a._v(" 就是通过 "),e("code",[a._v("Module._resolveFileName")]),a._v(" 方法实现的")]),a._v(" "),e("li",[e("code",[a._v("require.resolve")]),a._v(" 实现原理：\n"),e("ul",[e("li",[e("code",[a._v("Module._resolveFileName")]),a._v("方法核心流程有 3 点：\n"),e("ul",[e("li",[a._v("判断是否为内置模块")]),a._v(" "),e("li",[a._v("通过 "),e("code",[a._v("Module._resolveLookupPaths")]),a._v(" 方法生成 node_modules 可能存在的路径")]),a._v(" "),e("li",[a._v("通过 "),e("code",[a._v("Module._findPath")]),a._v(" 查询模块的真实路径")])])]),a._v(" "),e("li",[e("code",[a._v("Module._findPath")]),a._v(" 核心流程有 4 点：\n"),e("ul",[e("li",[a._v("查询缓存（将 request 和 paths 通过 "),e("code",[a._v("\\x00")]),a._v(" 合并成 cacheKey）")]),a._v(" "),e("li",[a._v("遍历 paths，将 path 与 request 组成文件路径 basePath")]),a._v(" "),e("li",[a._v("如果 basePath 存在则调用 "),e("code",[a._v("fs.realPathSync")]),a._v(" 获取文件真实路径")]),a._v(" "),e("li",[a._v("将文件真实路径缓存到 "),e("code",[a._v("Module._pathCache")]),a._v("（key 就是前面生成的 cacheKey）")])])]),a._v(" "),e("li",[e("code",[a._v("fs.realPathSync")]),a._v(" 核心流程有 3 点：\n"),e("ul",[e("li",[a._v("查询缓存（缓存的 key 为 p，即 "),e("code",[a._v("Module._findPath")]),a._v(" 中生成的文件路径）")]),a._v(" "),e("li",[a._v("从左往右遍历路径字符串，查询到 "),e("code",[a._v("/")]),a._v(" 时，拆分路径，判断该路径是否为软链接，如果是软链接则查询真实链接，并生成新路径 p，然后继续往后遍历，这里有 1 个细节需要特别注意：\n"),e("ul",[e("li",[a._v("遍历过程中生成的子路径 base 会缓存在 knownHard 和 cache 中，避免重复查询")])])]),a._v(" "),e("li",[a._v("遍历完成得到模块对应的真实路径，此时会将原始路径 original 作为 key，真实路径作为 value，保存到缓存中")])])])])]),a._v(" "),e("li",[e("code",[a._v("require.resolve.paths")]),a._v(" 等价于 "),e("code",[a._v("Module._resolveLookupPaths")]),a._v("，该方法用于获取所有 node_modules 可能存在的路径")]),a._v(" "),e("li",[e("code",[a._v("require.resolve.paths")]),a._v(" 实现原理：\n"),e("ul",[e("li",[a._v("如果路径为 "),e("code",[a._v("/")]),a._v("（根目录），直接返回 "),e("code",[a._v("['/node_modules']")])]),a._v(" "),e("li",[a._v("否则，将路径字符串从后往前遍历，查询到 "),e("code",[a._v("/")]),a._v(" 时，拆分路径，在后面加上 node_modules，并传入一个 paths 数组，直至查询不到 "),e("code",[a._v("/")]),a._v(" 后返回 paths 数组")])])])]),a._v(" "),e("h2",{attrs:{id:"本周作业"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本周作业"}},[a._v("#")]),a._v(" 本周作业")]),a._v(" "),e("ul",[e("li",[a._v("标准：\n"),e("ul",[e("li",[e("p",[a._v("理解脚手架的实现原理")])]),a._v(" "),e("li",[e("p",[a._v("基于 "),e("code",[a._v("Lerna")]),a._v(" 搭建自己的脚手架并发布到npm（功能不限）")])])])]),a._v(" "),e("li",[a._v("进阶：\n"),e("ul",[e("li",[a._v("理解 "),e("code",[a._v("Yargs")]),a._v(" 常用API和开发流程")]),a._v(" "),e("li",[a._v("理解 "),e("code",[a._v("Lerna")]),a._v(" 实现原理")]),a._v(" "),e("li",[a._v("理解 "),e("code",[a._v("import-local")]),a._v(" 实现原理，理解 "),e("code",[a._v("require.resolve")]),a._v(" 实现原理")])])]),a._v(" "),e("li",[a._v("本周打卡：\n"),e("ul",[e("li",[a._v("作业地址："),e("a",{attrs:{href:"https://github.com/imooc-lego/students-learn-task",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/imooc-lego/students-learn-task"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("学员学习任务，作业、打卡、分享，请看 "),e("a",{attrs:{href:"homework.imooc-lego.com"}},[a._v("homework.imooc-lego.com")])])])])])])}),[],!1,null,null,null);e.default=n.exports}}]);