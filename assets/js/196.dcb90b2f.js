(window.webpackJsonp=window.webpackJsonp||[]).push([[196],{487:function(v,_,t){"use strict";t.r(_);var a=t(10),l=Object(a.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h1",{attrs:{id:"jay-cli脚手架"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#jay-cli脚手架"}},[v._v("#")]),v._v(" jay-cli脚手架")]),v._v(" "),_("h2",{attrs:{id:"前言"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[v._v("#")]),v._v(" 前言")]),v._v(" "),_("ul",[_("li",[v._v("猎萝⼘平台是公司核⼼项⽬，包含toC端和crm等多个中后台系统，多个系统间有许多可复用的部分，如eslint配置、网络请求模块、埋点模块等，而新系统的开发往往采用代码拷贝的方式，开发效率较低；")]),v._v(" "),_("li",[v._v("为了提高团队整体研发效率，本人作为前端负责人，搭建了公司内部的通用脚手架jay-cli。架构上使用commander 实现脚手架，lerna进行多包管理，性能上使用node多进程和本地缓存提高执行效率；")]),v._v(" "),_("li",[v._v("通过脚手架结合项目模板，只需简单的命令行即可完成项目的初始化工作，达到项目模板快速复用的目的，团队整体研发效率得到有效提升，同时技术栈更统一，也更易于维护。")])]),v._v(" "),_("h2",{attrs:{id:"一、需求"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#一、需求"}},[v._v("#")]),v._v(" 一、需求")]),v._v(" "),_("ul",[_("li",[v._v("使用脚手架进行标准的项目初始化\n"),_("ul",[_("li",[_("strong",[v._v("jay init test-project")])])])]),v._v(" "),_("li",[v._v("需要支持的项目模板：\n"),_("ul",[_("li",[_("s",[_("strong",[v._v("C端项目模板：project-template-vue")])])]),v._v(" "),_("li",[_("strong",[v._v("中后台管理系统项目模板：project-template-hey-admin")])]),v._v(" "),_("li",[_("strong",[v._v("H5项目模板：project-template-h5")])]),v._v(" "),_("li",[_("s",[_("strong",[v._v("小程序项目模板：project-template-miniapp-remax")])])]),v._v(" "),_("li",[_("s",[v._v("Node服务端项目模板：project-template-express / project-template-koa2")])])])])]),v._v(" "),_("h2",{attrs:{id:"二、设计"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#二、设计"}},[v._v("#")]),v._v(" 二、设计")]),v._v(" "),_("h3",{attrs:{id:"架构设计图"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#架构设计图"}},[v._v("#")]),v._v(" 架构设计图")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://oss-1252175178.cos.ap-shanghai.myqcloud.com/%E6%85%95%E8%AF%BE%E7%BD%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%AF%BE%E7%A8%8B/%E8%84%9A%E6%89%8B%E6%9E%B6%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%9B%BE-%E8%87%AA%E5%88%B6.jpg",alt:""}})]),v._v(" "),_("p",[v._v("主要实现：")]),v._v(" "),_("ul",[_("li",[v._v("多包拆分，使用Lerna进行管理")]),v._v(" "),_("li",[v._v("1、"),_("code",[v._v("core")]),v._v(" 脚手架核心模块（"),_("strong",[v._v("执行准备、命令注册、命令执行")]),v._v("）")]),v._v(" "),_("li",[v._v("2、"),_("code",[v._v("init")]),v._v(" 项目初始化模块（"),_("strong",[v._v("项目模板下载")]),v._v("、"),_("em",[v._v("动态渲染")]),v._v("、"),_("em",[v._v("项目模板数据管理")]),v._v("）")])]),v._v(" "),_("h2",{attrs:{id:"三、实现流程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#三、实现流程"}},[v._v("#")]),v._v(" 三、实现流程")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("实现拆包：")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("core （cli、exec）")])]),v._v(" "),_("li",[_("p",[v._v("commands（init）")])]),v._v(" "),_("li",[_("p",[v._v("models（command）")])]),v._v(" "),_("li",[_("p",[v._v("utils（log、request）")])])])]),v._v(" "),_("li",[_("p",[v._v("脚手架核心开发")]),v._v(" "),_("ul",[_("li",[v._v("执行准备（检查Root、检查脚手架版本、提示脚手架新版本更新）")]),v._v(" "),_("li",[v._v("命令注册（设置帮助提示信息、注册init命令）")]),v._v(" "),_("li",[v._v("命令执行（生成缓存路径、"),_("strong",[v._v("node多进程")]),v._v("执行本地代码入口文件）")])])]),v._v(" "),_("li",[_("p",[v._v("init初始化开发")]),v._v(" "),_("ul",[_("li",[v._v("准备阶段（获取模板列表、用户选择项目模板）")]),v._v(" "),_("li",[v._v("模板下载（download-git-repo下载项目模板）")]),v._v(" "),_("li",[v._v("模板安装（复制文件、安装依赖）")])])])]),v._v(" "),_("h2",{attrs:{id:"四、难点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#四、难点"}},[v._v("#")]),v._v(" 四、难点")]),v._v(" "),_("p",[v._v("脚手架核心模块")]),v._v(" "),_("ul",[_("li",[v._v("lerna使用和原理")]),v._v(" "),_("li",[v._v("command使用和原理")]),v._v(" "),_("li",[v._v("动态命令调用")]),v._v(" "),_("li",[v._v("Node多进程命令执行")]),v._v(" "),_("li",[v._v("本地缓存")])]),v._v(" "),_("p",[v._v("项目初始化模块")]),v._v(" "),_("ul",[_("li",[v._v("inquiry使用和原理")]),v._v(" "),_("li",[v._v("项目模板初始化")]),v._v(" "),_("li",[_("strong",[v._v("项目模板下载")]),v._v("（npm vs git）（"),_("strong",[v._v("download-git-repo")]),v._v("）")]),v._v(" "),_("li",[v._v("动态渲染 ejs/glob")])]),v._v(" "),_("h2",{attrs:{id:"五、话术"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#五、话术"}},[v._v("#")]),v._v(" 五、话术")]),v._v(" "),_("p",[v._v("【Situation 背景】")]),v._v(" "),_("p",[v._v("猎萝⼘平台是公司核⼼项⽬，致力于提升招聘过程中的效率和体验。平台包含toC端和crm等多个中后台系统，多个系统间有许多可复用的部分，如eslint配置、网络请求、埋点等，而新系统的开发往往采用代码拷贝后删减的方式，开发效率较低；")]),v._v(" "),_("p",[v._v("【Target 目标】")]),v._v(" "),_("p",[v._v("为了提高团队整体研发效率")]),v._v(" "),_("p",[v._v("【Action 行动】")]),v._v(" "),_("p",[v._v("本人作为前端负责人，搭建了公司内部的脚手架jay-cli，具有"),_("strong",[v._v("可扩展")]),v._v("、"),_("strong",[v._v("高性能")]),v._v("等特点。架构上使用lerna进行多包管理，commander 库来实现脚手架，并使用node多进程和本地缓存等技术提高执行效率；")]),v._v(" "),_("p",[v._v("【Result 结果】")]),v._v(" "),_("p",[v._v("通过脚手架与项目模板相结合，只需简单的命令行即可完成项目的初始化工作，达到项目模板快速复用的目的，团队整体研发效率得到有效提升，同时技术栈更统一，也更易于维护。")]),v._v(" "),_("ul",[_("li",[_("p",[v._v("jay-cli脚手架属于工程化的一部分，它可以在项目初始化阶段帮助我们快速的复用已有的项目模板。")])]),v._v(" "),_("li",[_("p",[v._v("设计之初考虑到未来的可扩展性，参考 vue-cli 对功能模块进行了拆分，并采用了lerna进行管理，主要分为3个部分：")]),v._v(" "),_("ul",[_("li",[_("code",[v._v("core")]),v._v("，脚手架核心模块，主要负责脚手架初始化、命令注册、命令执行（ "),_("code",[v._v("npminstall")]),v._v(" 、"),_("code",[v._v("require('@jay-cli/init')")]),v._v(" 、child_process.spawn）等")]),v._v(" "),_("li",[_("code",[v._v("commands")]),v._v("  命令，比如 init")]),v._v(" "),_("li",[_("code",[v._v("utils")]),v._v(" 工具方法，比如 "),_("code",[v._v("npmlog")]),v._v(" 打印、获取npm包信息等")])])]),v._v(" "),_("li",[_("p",[v._v("性能这部分呢也有做一些优化，比如：")]),v._v(" "),_("ul",[_("li",[v._v("命令执行时使用node多进程 child_process.spawn，提升执行效率")]),v._v(" "),_("li",[v._v("命令包下载后保存，在本地缓存中，无需每次都下载")])])])]),v._v(" "),_("h2",{attrs:{id:"六、q-a"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#六、q-a"}},[v._v("#")]),v._v(" 六、Q&A")]),v._v(" "),_("h3",{attrs:{id:"脚手架的原理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#脚手架的原理"}},[v._v("#")]),v._v(" 脚手架的原理")]),v._v(" "),_("h3",{attrs:{id:"lerna的使用和原理"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#lerna的使用和原理"}},[v._v("#")]),v._v(" Lerna的使用和原理")]),v._v(" "),_("ul",[_("li",[v._v("多包框架要解决的问题")])]),v._v(" "),_("h3",{attrs:{id:"遇到的问题和收获"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题和收获"}},[v._v("#")]),v._v(" 遇到的问题和收获")]),v._v(" "),_("ul",[_("li",[v._v("本地调试方法： "),_("code",[v._v("npm link")]),v._v(" => "),_("code",[v._v("file:../../")])]),v._v(" "),_("li",[v._v("如何支持 "),_("code",[v._v("--debug")]),v._v(" 打印信息 ： 命令行 => 环境变量 =>  "),_("code",[v._v("npmlog")]),v._v(" 设置 level")]),v._v(" "),_("li",[v._v("许多有用的小工具库\n"),_("ul",[_("li",[_("strong",[v._v("npmlog")])]),v._v(" "),_("li",[v._v("fs-extra")]),v._v(" "),_("li",[_("strong",[v._v("semver")])]),v._v(" "),_("li",[v._v("colors")]),v._v(" "),_("li",[v._v("user-home")]),v._v(" "),_("li",[v._v("dotenv")]),v._v(" "),_("li",[_("strong",[v._v("root-check")])])])])]),v._v(" "),_("h2",{attrs:{id:"参考"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[v._v("#")]),v._v(" 参考")]),v._v(" "),_("p",[v._v("项目地址：https://gitee.com/AaronKong/jay-cli")])])}),[],!1,null,null,null);_.default=l.exports}}]);