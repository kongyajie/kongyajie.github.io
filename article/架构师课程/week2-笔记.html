<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端AK君</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/favicon.ico">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?e864a64a0fefae1239747c553f0d6579";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <script src="https://cdn-go.cn/aegis/aegis-sdk/latest/aegis.min.js"></script>
    <script>
      var aegis = new Aegis({
        id: 'yaoVL8AlJ1zqMDq4dG', // 上报 id
        uin: 'xxx', // 用户唯一 ID（可选）
        reportApiSpeed: true, // 接口测速
        reportAssetSpeed: true, // 静态资源测速
        spa: true // spa 应用页面跳转的时候开启 pv 计算
      });
    </script>
    <meta name="description" content="系统性学习，打造完善的知识体系">
    
    <link rel="preload" href="/assets/css/0.styles.30ce95d4.css" as="style"><link rel="preload" href="/assets/js/app.a2d0ac2d.js" as="script"><link rel="preload" href="/assets/js/2.6d2266aa.js" as="script"><link rel="preload" href="/assets/js/198.556c32f1.js" as="script"><link rel="prefetch" href="/assets/js/10.a56f3f8d.js"><link rel="prefetch" href="/assets/js/100.13a2d5e4.js"><link rel="prefetch" href="/assets/js/101.766996fe.js"><link rel="prefetch" href="/assets/js/102.263781e6.js"><link rel="prefetch" href="/assets/js/103.192765b9.js"><link rel="prefetch" href="/assets/js/104.8280cd3d.js"><link rel="prefetch" href="/assets/js/105.3ad0084c.js"><link rel="prefetch" href="/assets/js/106.0344c291.js"><link rel="prefetch" href="/assets/js/107.80e4eaf9.js"><link rel="prefetch" href="/assets/js/108.95402323.js"><link rel="prefetch" href="/assets/js/109.e42d7c45.js"><link rel="prefetch" href="/assets/js/11.c0cc9e98.js"><link rel="prefetch" href="/assets/js/110.fe64548d.js"><link rel="prefetch" href="/assets/js/111.78281284.js"><link rel="prefetch" href="/assets/js/112.eccae065.js"><link rel="prefetch" href="/assets/js/113.458fbd21.js"><link rel="prefetch" href="/assets/js/114.3157d04b.js"><link rel="prefetch" href="/assets/js/115.9a08b5bf.js"><link rel="prefetch" href="/assets/js/116.98c14a80.js"><link rel="prefetch" href="/assets/js/117.c99eb6ef.js"><link rel="prefetch" href="/assets/js/118.9415eb32.js"><link rel="prefetch" href="/assets/js/119.8677a924.js"><link rel="prefetch" href="/assets/js/12.ada7d686.js"><link rel="prefetch" href="/assets/js/120.90c94c3f.js"><link rel="prefetch" href="/assets/js/121.289ff03f.js"><link rel="prefetch" href="/assets/js/122.163e6cf3.js"><link rel="prefetch" href="/assets/js/123.6cf64cab.js"><link rel="prefetch" href="/assets/js/124.4fbd6264.js"><link rel="prefetch" href="/assets/js/125.8f408d49.js"><link rel="prefetch" href="/assets/js/126.fecd9dfa.js"><link rel="prefetch" href="/assets/js/127.fff3baac.js"><link rel="prefetch" href="/assets/js/128.9006ec12.js"><link rel="prefetch" href="/assets/js/129.bd73fd0d.js"><link rel="prefetch" href="/assets/js/13.7d5054e0.js"><link rel="prefetch" href="/assets/js/130.82ec8ca8.js"><link rel="prefetch" href="/assets/js/131.25af9bac.js"><link rel="prefetch" href="/assets/js/132.8517ca6b.js"><link rel="prefetch" href="/assets/js/133.f835df32.js"><link rel="prefetch" href="/assets/js/134.65e4285e.js"><link rel="prefetch" href="/assets/js/135.d5ae9ddf.js"><link rel="prefetch" href="/assets/js/136.b4809f7f.js"><link rel="prefetch" href="/assets/js/137.4a9d350b.js"><link rel="prefetch" href="/assets/js/138.0817585f.js"><link rel="prefetch" href="/assets/js/139.25212b17.js"><link rel="prefetch" href="/assets/js/14.dfdc52dc.js"><link rel="prefetch" href="/assets/js/140.f61db2a2.js"><link rel="prefetch" href="/assets/js/141.4d216e94.js"><link rel="prefetch" href="/assets/js/142.51c5e63e.js"><link rel="prefetch" href="/assets/js/143.5728dc3f.js"><link rel="prefetch" href="/assets/js/144.f287e90f.js"><link rel="prefetch" href="/assets/js/145.1cf839cb.js"><link rel="prefetch" href="/assets/js/146.23f4f258.js"><link rel="prefetch" href="/assets/js/147.d39c4f95.js"><link rel="prefetch" href="/assets/js/148.b1a175dc.js"><link rel="prefetch" href="/assets/js/149.a52de27b.js"><link rel="prefetch" href="/assets/js/15.4f0aba52.js"><link rel="prefetch" href="/assets/js/150.10168789.js"><link rel="prefetch" href="/assets/js/151.712cd6a8.js"><link rel="prefetch" href="/assets/js/152.3fe32db9.js"><link rel="prefetch" href="/assets/js/153.58f830dd.js"><link rel="prefetch" href="/assets/js/154.f5506c0b.js"><link rel="prefetch" href="/assets/js/155.715a7171.js"><link rel="prefetch" href="/assets/js/156.c373b316.js"><link rel="prefetch" href="/assets/js/157.7ae757e4.js"><link rel="prefetch" href="/assets/js/158.8547baa5.js"><link rel="prefetch" href="/assets/js/159.9236e9b2.js"><link rel="prefetch" href="/assets/js/16.401bab98.js"><link rel="prefetch" href="/assets/js/160.38f02fa7.js"><link rel="prefetch" href="/assets/js/161.33cfc804.js"><link rel="prefetch" href="/assets/js/162.b936f336.js"><link rel="prefetch" href="/assets/js/163.457054d9.js"><link rel="prefetch" href="/assets/js/164.d8f480fd.js"><link rel="prefetch" href="/assets/js/165.8d33e67c.js"><link rel="prefetch" href="/assets/js/166.24fd6fff.js"><link rel="prefetch" href="/assets/js/167.a71cfd81.js"><link rel="prefetch" href="/assets/js/168.f195e962.js"><link rel="prefetch" href="/assets/js/169.a233777b.js"><link rel="prefetch" href="/assets/js/17.ff1a5c44.js"><link rel="prefetch" href="/assets/js/170.e9f4408c.js"><link rel="prefetch" href="/assets/js/171.59c967e2.js"><link rel="prefetch" href="/assets/js/172.822a3819.js"><link rel="prefetch" href="/assets/js/173.c37db229.js"><link rel="prefetch" href="/assets/js/174.333678df.js"><link rel="prefetch" href="/assets/js/175.7c0f4462.js"><link rel="prefetch" href="/assets/js/176.29ec561f.js"><link rel="prefetch" href="/assets/js/177.66c9abc0.js"><link rel="prefetch" href="/assets/js/178.7ac94227.js"><link rel="prefetch" href="/assets/js/179.84edddc4.js"><link rel="prefetch" href="/assets/js/18.48189038.js"><link rel="prefetch" href="/assets/js/180.f9200d00.js"><link rel="prefetch" href="/assets/js/181.3dbd3f3d.js"><link rel="prefetch" href="/assets/js/182.92327331.js"><link rel="prefetch" href="/assets/js/183.6f4a7fa6.js"><link rel="prefetch" href="/assets/js/184.23cc8f2b.js"><link rel="prefetch" href="/assets/js/185.13f68d36.js"><link rel="prefetch" href="/assets/js/186.fee33fbb.js"><link rel="prefetch" href="/assets/js/187.45622918.js"><link rel="prefetch" href="/assets/js/188.d660fe0b.js"><link rel="prefetch" href="/assets/js/189.d66284c8.js"><link rel="prefetch" href="/assets/js/19.fe215aac.js"><link rel="prefetch" href="/assets/js/190.47c4010f.js"><link rel="prefetch" href="/assets/js/191.43e428b5.js"><link rel="prefetch" href="/assets/js/192.204764f1.js"><link rel="prefetch" href="/assets/js/193.5ba3e1f7.js"><link rel="prefetch" href="/assets/js/194.994dc46d.js"><link rel="prefetch" href="/assets/js/195.089189c2.js"><link rel="prefetch" href="/assets/js/196.dcb90b2f.js"><link rel="prefetch" href="/assets/js/197.f08d0d50.js"><link rel="prefetch" href="/assets/js/199.31bd0633.js"><link rel="prefetch" href="/assets/js/20.d701da2a.js"><link rel="prefetch" href="/assets/js/200.723aec7c.js"><link rel="prefetch" href="/assets/js/201.66d2af64.js"><link rel="prefetch" href="/assets/js/202.8edb3a46.js"><link rel="prefetch" href="/assets/js/203.ff89198b.js"><link rel="prefetch" href="/assets/js/204.193ae8af.js"><link rel="prefetch" href="/assets/js/205.c829f1c5.js"><link rel="prefetch" href="/assets/js/206.37bea224.js"><link rel="prefetch" href="/assets/js/207.db95cc40.js"><link rel="prefetch" href="/assets/js/208.97270da0.js"><link rel="prefetch" href="/assets/js/209.c0683036.js"><link rel="prefetch" href="/assets/js/21.1080a5de.js"><link rel="prefetch" href="/assets/js/210.93d642a2.js"><link rel="prefetch" href="/assets/js/211.5901dc1b.js"><link rel="prefetch" href="/assets/js/212.4f664375.js"><link rel="prefetch" href="/assets/js/213.fa04deb5.js"><link rel="prefetch" href="/assets/js/214.7b142a2c.js"><link rel="prefetch" href="/assets/js/215.7803263b.js"><link rel="prefetch" href="/assets/js/216.64db2edb.js"><link rel="prefetch" href="/assets/js/217.b41dbc99.js"><link rel="prefetch" href="/assets/js/218.e9327b94.js"><link rel="prefetch" href="/assets/js/219.63d9aab5.js"><link rel="prefetch" href="/assets/js/22.76e06f13.js"><link rel="prefetch" href="/assets/js/220.003286bb.js"><link rel="prefetch" href="/assets/js/221.b8b15996.js"><link rel="prefetch" href="/assets/js/222.0a20e90e.js"><link rel="prefetch" href="/assets/js/223.a19bafae.js"><link rel="prefetch" href="/assets/js/224.e9bcab46.js"><link rel="prefetch" href="/assets/js/225.5a36176a.js"><link rel="prefetch" href="/assets/js/226.be890eda.js"><link rel="prefetch" href="/assets/js/227.0e73737e.js"><link rel="prefetch" href="/assets/js/228.44593996.js"><link rel="prefetch" href="/assets/js/229.01729fa1.js"><link rel="prefetch" href="/assets/js/23.7076ecb8.js"><link rel="prefetch" href="/assets/js/24.d236b1c8.js"><link rel="prefetch" href="/assets/js/25.085e91d6.js"><link rel="prefetch" href="/assets/js/26.8c2f26f2.js"><link rel="prefetch" href="/assets/js/27.a1e3cc80.js"><link rel="prefetch" href="/assets/js/28.6c00042a.js"><link rel="prefetch" href="/assets/js/29.cfd8d697.js"><link rel="prefetch" href="/assets/js/3.b6a2a037.js"><link rel="prefetch" href="/assets/js/30.3d728bce.js"><link rel="prefetch" href="/assets/js/31.526dedbf.js"><link rel="prefetch" href="/assets/js/32.6b3ecd17.js"><link rel="prefetch" href="/assets/js/33.cabdeeb0.js"><link rel="prefetch" href="/assets/js/34.fa91d53d.js"><link rel="prefetch" href="/assets/js/35.c66844f8.js"><link rel="prefetch" href="/assets/js/36.3fa680ce.js"><link rel="prefetch" href="/assets/js/37.a92ad777.js"><link rel="prefetch" href="/assets/js/38.e7cc8ec1.js"><link rel="prefetch" href="/assets/js/39.2796c271.js"><link rel="prefetch" href="/assets/js/4.e81d099d.js"><link rel="prefetch" href="/assets/js/40.daf5b79e.js"><link rel="prefetch" href="/assets/js/41.eef20117.js"><link rel="prefetch" href="/assets/js/42.e8f1e994.js"><link rel="prefetch" href="/assets/js/43.f61d31c8.js"><link rel="prefetch" href="/assets/js/44.8dbd447e.js"><link rel="prefetch" href="/assets/js/45.66449725.js"><link rel="prefetch" href="/assets/js/46.4af09bf8.js"><link rel="prefetch" href="/assets/js/47.1289bfb2.js"><link rel="prefetch" href="/assets/js/48.a4fb9dbd.js"><link rel="prefetch" href="/assets/js/49.8751b36a.js"><link rel="prefetch" href="/assets/js/5.c08ba69c.js"><link rel="prefetch" href="/assets/js/50.75e594dd.js"><link rel="prefetch" href="/assets/js/51.3d254128.js"><link rel="prefetch" href="/assets/js/52.9c1413b9.js"><link rel="prefetch" href="/assets/js/53.5a3597d7.js"><link rel="prefetch" href="/assets/js/54.0d47034c.js"><link rel="prefetch" href="/assets/js/55.6d652079.js"><link rel="prefetch" href="/assets/js/56.ecc52ae0.js"><link rel="prefetch" href="/assets/js/57.ecfbc927.js"><link rel="prefetch" href="/assets/js/58.7cd62408.js"><link rel="prefetch" href="/assets/js/59.204705c1.js"><link rel="prefetch" href="/assets/js/6.6c5dca8e.js"><link rel="prefetch" href="/assets/js/60.b40b1d39.js"><link rel="prefetch" href="/assets/js/61.0b04acf8.js"><link rel="prefetch" href="/assets/js/62.7fbeb25d.js"><link rel="prefetch" href="/assets/js/63.b709d9fc.js"><link rel="prefetch" href="/assets/js/64.e183bd0e.js"><link rel="prefetch" href="/assets/js/65.c89124e0.js"><link rel="prefetch" href="/assets/js/66.caa96c79.js"><link rel="prefetch" href="/assets/js/67.11d21c7a.js"><link rel="prefetch" href="/assets/js/68.be82890e.js"><link rel="prefetch" href="/assets/js/69.14649e16.js"><link rel="prefetch" href="/assets/js/7.9d17a6f4.js"><link rel="prefetch" href="/assets/js/70.a7391131.js"><link rel="prefetch" href="/assets/js/71.437f0d23.js"><link rel="prefetch" href="/assets/js/72.5d8001be.js"><link rel="prefetch" href="/assets/js/73.a4a5d2ac.js"><link rel="prefetch" href="/assets/js/74.cd496622.js"><link rel="prefetch" href="/assets/js/75.773ff345.js"><link rel="prefetch" href="/assets/js/76.176d2fa0.js"><link rel="prefetch" href="/assets/js/77.c38d66f9.js"><link rel="prefetch" href="/assets/js/78.8ca89620.js"><link rel="prefetch" href="/assets/js/79.21f0b5ad.js"><link rel="prefetch" href="/assets/js/8.61c359d6.js"><link rel="prefetch" href="/assets/js/80.e75ea7ff.js"><link rel="prefetch" href="/assets/js/81.48187974.js"><link rel="prefetch" href="/assets/js/82.0f048d77.js"><link rel="prefetch" href="/assets/js/83.d2b53680.js"><link rel="prefetch" href="/assets/js/84.0aba3b37.js"><link rel="prefetch" href="/assets/js/85.7d57722c.js"><link rel="prefetch" href="/assets/js/86.b07deb45.js"><link rel="prefetch" href="/assets/js/87.3ea155a5.js"><link rel="prefetch" href="/assets/js/88.0369b082.js"><link rel="prefetch" href="/assets/js/89.8d286a9e.js"><link rel="prefetch" href="/assets/js/9.b44b1047.js"><link rel="prefetch" href="/assets/js/90.6cb0b442.js"><link rel="prefetch" href="/assets/js/91.3bd0ca3f.js"><link rel="prefetch" href="/assets/js/92.e244701b.js"><link rel="prefetch" href="/assets/js/93.ec9d3001.js"><link rel="prefetch" href="/assets/js/94.517396bc.js"><link rel="prefetch" href="/assets/js/95.570e2963.js"><link rel="prefetch" href="/assets/js/96.d4608a89.js"><link rel="prefetch" href="/assets/js/97.4814fa03.js"><link rel="prefetch" href="/assets/js/98.b57acf57.js"><link rel="prefetch" href="/assets/js/99.662fa199.js">
    <link rel="stylesheet" href="/assets/css/0.styles.30ce95d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="前端AK君" class="logo"> <span class="site-name can-hide">前端AK君</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/kongyajie" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/kongyajie" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JS进阶</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/article/前端基础/JS进阶/JS进阶系列.html" class="sidebar-link">JS进阶系列</a></li><li><a href="/article/前端基础/JS进阶/JS概览.html" class="sidebar-link">JS概览</a></li><li><a href="/article/前端基础/JS进阶/JS类型.html" class="sidebar-link">JS类型</a></li><li><a href="/article/前端基础/JS进阶/JS原型原型链.html" class="sidebar-link">JS原型和原型链</a></li><li><a href="/article/前端基础/JS进阶/JS执行机制.html" class="sidebar-link">JS执行机制</a></li><li><a href="/article/前端基础/JS进阶/JS异步编程.html" class="sidebar-link">JS异步编程</a></li><li><a href="/article/前端基础/JS进阶/JS异步进阶.html" class="sidebar-link">JS异步进阶</a></li><li><a href="/article/前端基础/JS进阶/JS异常处理.html" class="sidebar-link">JS异常处理</a></li><li><a href="/article/前端基础/JS进阶/JS精选题集.html" class="sidebar-link">JS精选题集</a></li><li><a href="/article/前端基础/JS编程/总览.html" class="sidebar-link">JS编程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端自检</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>[TOC]</p> <h1 id="week2-脚手架架构设计和框架搭建"><a href="#week2-脚手架架构设计和框架搭建" class="header-anchor">#</a> Week2 脚手架架构设计和框架搭建</h1> <p><a href="https://www.imooc.com/wiki/weban/week1a.html" target="_blank" rel="noopener noreferrer">前端架构师-电子书<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="本周导学"><a href="#本周导学" class="header-anchor">#</a> 本周导学</h2> <h3 id="将收获什么"><a href="#将收获什么" class="header-anchor">#</a> 将收获什么</h3> <ul><li>脚手架的实现原理</li> <li>Lerna的常见用法</li> <li>架构设计技巧和架构图绘制方法</li></ul> <h3 id="主要内容"><a href="#主要内容" class="header-anchor">#</a> 主要内容</h3> <ul><li>学习如何以架构师的角度思考基础架构问题</li> <li>多Package项目管理痛点和解决方案，基于Lerna脚手架框架搭建</li> <li>imooc-cli脚手架需求分析和架构设计、架构设计图</li></ul> <h3 id="附赠内容"><a href="#附赠内容" class="header-anchor">#</a> 附赠内容</h3> <ul><li>脚手架调试技巧</li> <li>Lerna源码分析（Node的module模块分析、yargs使用方法、剖析Lerna架构设计）</li></ul> <h3 id="关键词"><a href="#关键词" class="header-anchor">#</a> 关键词</h3> <ul><li>脚手架 - 掌握脚手架原理和开发全流程</li> <li>Lerna - 解决多Package项目管理痛点</li> <li>架构设计 - 学习大厂基础基础架构设计思路</li></ul> <h3 id="学习方法"><a href="#学习方法" class="header-anchor">#</a> 学习方法</h3> <ul><li><strong>架构三部曲：掌握原理 -&gt; 独立思考 -&gt; 总结反思</strong></li> <li>深度剖析优秀开源项目，由表及里，由浅入深</li> <li><strong>视角切换：多切换到架构师视角，从全局思考问题</strong></li></ul> <h3 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h3> <ul><li>整体难度不高，不用担心学不会，坚持打卡写心得</li> <li>优秀的程序猿不止能够实现功能，更多读懂别人的代码，读懂别人的想法</li> <li>从知名的开源项目中汲取养分，为我所用，助我成长</li></ul> <h3 id="前端脚手架imooc-cli核心功能演示"><a href="#前端脚手架imooc-cli核心功能演示" class="header-anchor">#</a> 前端脚手架imooc-cli核心功能演示</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> i <span class="token parameter variable">-g</span> @imooc-cli/core
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_1、站在前端研发的视角-分析开发脚手架的必要性"><a href="#_1、站在前端研发的视角-分析开发脚手架的必要性" class="header-anchor">#</a> 1、站在前端研发的视角，分析开发脚手架的必要性</h2> <h3 id="研发效能"><a href="#研发效能" class="header-anchor">#</a> 研发效能</h3> <p><strong>开发脚手架的核心目标是：提升前端研发效能</strong></p> <p>大厂研发架构图：</p> <p><img src="https://oss-1252175178.cos.ap-shanghai.myqcloud.com/%E6%85%95%E8%AF%BE%E7%BD%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%AF%BE%E7%A8%8B/%E5%A4%A7%E5%8E%82%E7%A0%94%E5%8F%91%E6%9E%B6%E6%9E%84%E5%9B%BE.png" alt=""></p> <h3 id="脚手架核心价值"><a href="#脚手架核心价值" class="header-anchor">#</a> 脚手架核心价值</h3> <p>将研发过程：</p> <ul><li>自动化：项目重复代码拷贝/git操作/发布上线操作</li> <li>标准化：项目创建/git flow/发布流程/回滚流程</li> <li>数据化：研发过程系统化、数据化，使得研发过程可量化</li></ul> <h3 id="和自动化构建工具区别"><a href="#和自动化构建工具区别" class="header-anchor">#</a> 和自动化构建工具区别</h3> <blockquote><p>问题：jenkins、travis等自动化构建工具已经比较成熟了，为什么还需要自研脚手架？</p></blockquote> <ul><li>不满足需求：jenkins、travis通常在git hooks中触发，需要在服务端执行，无法覆盖研发人员本地的功能，如：创建项目自动化、本地git操作自动化等</li> <li>定制复杂：jenkins、travis定制过程需要开发插件，其过程较为复杂，需要使用Java语言，对前端同学不够友好</li></ul> <h2 id="_2、从使用角度理解什么是脚手架"><a href="#_2、从使用角度理解什么是脚手架" class="header-anchor">#</a> 2、从使用角度理解什么是脚手架？</h2> <h3 id="脚手架简介"><a href="#脚手架简介" class="header-anchor">#</a> 脚手架简介</h3> <blockquote><p>脚手架本质是一个操作系统的客户端，它通过命令行执行。</p></blockquote> <p>比如：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>vue create vue-test-app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>上面这条命令由 3 个部分组成：</p> <ul><li>主命令: vue</li> <li>command: create</li> <li>command 的 param: vue-test-app</li></ul> <p>它表示创建一个 vue 项目，项目的名称为 vue-test-app，以上是最一个较为简单的脚手架命令。</p> <h3 id="脚手架的执行原理"><a href="#脚手架的执行原理" class="header-anchor">#</a> 脚手架的执行原理</h3> <p><img src="https://oss-1252175178.cos.ap-shanghai.myqcloud.com/%E6%85%95%E8%AF%BE%E7%BD%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%AF%BE%E7%A8%8B/%E8%84%9A%E6%89%8B%E6%9E%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86.jpeg" alt=""></p> <p>脚手架的执行原理如下：</p> <ul><li>在终端输入 vue create vue-test-app</li> <li>终端解析出 vue 命令</li> <li>终端在环境变量中找到 vue 命令</li> <li>终端根据 vue 命令链接到实际文件 vue.js</li> <li>终端利用 node 执行 vue.js</li> <li>vue.js 解析 command / options</li> <li>vue.js 执行 command</li> <li>执行完毕，退出执行</li></ul> <h2 id="_3、脚手架的实现原理"><a href="#_3、脚手架的实现原理" class="header-anchor">#</a> 3、脚手架的实现原理</h2> <p>问题：</p> <ol><li>全局安装 <code>@vue/cli</code> 时发生了什么？
<ul><li>将 <code>@vue/cli</code> 安装到 <code>node/lib/node_module</code> 中</li> <li>创建软链 <code>vue</code> 链接到 <code>@vue/cli</code> 项目中的 <code>bin/vue.js</code> （在终端中使用 <code>which vue</code> 查看）</li></ul></li> <li>在终端执行 <code>vue create vue-test-app</code> 时发生了什么？
<ul><li>终端解析出 vue 命令</li> <li>终端在环境变量中找到 vue 命令</li> <li>终端根据 vue 命令链接到实际文件 vue.js</li> <li>终端利用 node 执行 vue.js</li></ul></li></ol> <p>脚手架执行的全过程：</p> <p><img src="https://oss-1252175178.cos.ap-shanghai.myqcloud.com/%E6%85%95%E8%AF%BE%E7%BD%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%AF%BE%E7%A8%8B/%E8%84%9A%E6%89%8B%E6%9E%B6%E5%8E%9F%E7%90%86%E8%BF%9B%E9%98%B6.png" alt=""></p> <h2 id="_4、脚手架的开发流程"><a href="#_4、脚手架的开发流程" class="header-anchor">#</a> 4、脚手架的开发流程</h2> <h3 id="开发流程"><a href="#开发流程" class="header-anchor">#</a> 开发流程</h3> <ol><li>创建项目，并初始化 npm</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> jay-cli-demo <span class="token comment"># 创建项目目录</span>
<span class="token builtin class-name">cd</span> jay-cli-demo <span class="token comment"># 进入目录</span>
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>  <span class="token comment"># 初始化npm</span>
code <span class="token builtin class-name">.</span> <span class="token comment"># 使用vscode打开项目</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>新建bin目录，并在目录下新增index.js文件，做为脚手架入口文件（注意要再最上方添加一行代码，用于查找当前使用环境下的node）：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'welcome to jay-cli-demo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>配置 package.json，添加 bin 属性</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jay-cli-demo&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;jay-test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/index.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="4"><li>将脚手架发布到 npm（发布过程中遇到问题请请参考网上的发布文章）</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> publish <span class="token comment"># 发布到npm</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意，因为npm不允许出现重复的包名，因此需要将上一步中 package.json 中的 name 从 <code>jay-cli-demo</code> 改为 <a href="https://www.npmjs.com/" target="_blank" rel="noopener noreferrer">npmjs.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>  上未被占用的名字。</p></blockquote> <h3 id="使用流程"><a href="#使用流程" class="header-anchor">#</a> 使用流程</h3> <ol><li>安装脚手架</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> jay-cli-demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>使用脚手架</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>jay-test
<span class="token comment"># welcome to jay-cli-demo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="开发难点"><a href="#开发难点" class="header-anchor">#</a> 开发难点</h3> <ul><li>分包：将复杂的系统拆分成若干个模块</li> <li>命令注册</li> <li>参数解析</li></ul> <p>还有很多，比如：</p> <ul><li>命令行交互</li> <li>日志打印</li> <li>命令行文字变色</li> <li>网络通信：HTTP/WebSocket</li> <li>文件处理</li></ul> <h3 id="本地调试"><a href="#本地调试" class="header-anchor">#</a> 本地调试</h3> <p>以 <code>jay-cli-test</code> 为例</p> <p><strong>方法一：在项目目录下使用 <code>npm link</code>：</strong></p> <ul><li>在 <code>.nvm/versions/node/v14.15.4/lib/node_modules</code> 目录中，会创建一个 <code>jay-cli-test</code> 软链,链接到项目目录</li> <li>运行 <code>jay-cli-test</code> 即运行项目目录中 <code>package.json</code> 中的 <code>bin</code> 配置命令</li></ul> <p><strong>方法二：在项目目录的父级下使用 <code>npm i jay-cli-test -g</code></strong></p> <ul><li>npm 会默认给我们创建一个软链，效果同上</li> <li>如果希望删除这个软链，使用npm线上版本，可以在这个项目目录的非父级目录下，再来一次 <code>npm i jay-cli-test -g</code> 即可。</li></ul> <p>分包情况：以 <code>jay-cli-test-lib</code> 为例。</p> <h3 id="本地link标准流程"><a href="#本地link标准流程" class="header-anchor">#</a> 本地link标准流程</h3> <p>链接本地脚手架：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> your-cli-dir
<span class="token function">npm</span> <span class="token function">link</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>链接本地库文件：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> your-lib-dir
<span class="token function">npm</span> <span class="token function">link</span>
<span class="token builtin class-name">cd</span> your-cli-dir
<span class="token function">npm</span> <span class="token function">link</span> your-lib
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>取消链接本地库文件：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 删除主项目对库文件的软链</span>
<span class="token builtin class-name">cd</span> your-cli-dir
<span class="token function">npm</span> unlink your-lib

<span class="token comment"># 删除库文件的本地软链</span>
<span class="token builtin class-name">cd</span> your-lib-dir
<span class="token function">npm</span> unlink

<span class="token comment"># 删除主项目的软链</span>
<span class="token builtin class-name">cd</span> your-cli-dir
<span class="token function">npm</span> unlink

<span class="token comment"># 当遇到库文件link不存在的情况时，可尝试下面的方式解决</span>
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> node_modules
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-S</span> your-lib
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>理解 <code>npm link</code>：</p> <ul><li><code>npm link your-lib</code>：将当前项目中 <code>node_modules</code> 下指定的库文件链接到 <code>node</code> 全局 <code>node_modules</code> 下的库文件</li> <li><code>npm link</code>：将当前项目链接到 <code>node</code> 全局 <code>node_modules</code> 中作为一个库文件，并解析 <code>bin</code> 配置创建可执行文件</li></ul> <p>理解 <code>npm unlink</code>：</p> <ul><li><code>npm unlink</code>：将当前项目从 <code>node</code> 全局 <code>node_modules</code> 中移除</li> <li><code>npm unlink your-lib</code>：将当前项目中的库文件依赖移除</li></ul> <p>注意，使用 <code>nvm</code> 管理 npm 后情况稍有不同：</p> <ul><li>全局 <code>node_modules</code> 目录为：<code>/Users/aaron/.nvm/versions/node/v14.15.4/lib/node_modules</code></li> <li>bin 目录为：<code>/Users/aaron/.nvm/versions/node/v14.15.4/bin</code></li> <li>bin 目录中的指令指向全局 <code>node_modules</code> 中的依赖</li></ul> <h3 id="产出测试脚手架-jay-test-cli"><a href="#产出测试脚手架-jay-test-cli" class="header-anchor">#</a> 产出测试脚手架 — jay-test-cli</h3> <p><a href="https://gitee.com/AaronKong/jay-test" target="_blank" rel="noopener noreferrer">代码地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>npm包：</p> <ul><li><a href="https://www.npmjs.com/package/jay-test-cli" target="_blank" rel="noopener noreferrer">jay-test-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.npmjs.com/package/jay-test-cli-lib" target="_blank" rel="noopener noreferrer">jay-test-cli-lib<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>使用方式：</p> <ol><li>安装： <code>npm i jay-test-cli -g</code></li> <li>运行： <code>jay-test-cli -V</code></li></ol> <h2 id="_5、lerna简介"><a href="#_5、lerna简介" class="header-anchor">#</a> 5、Lerna简介</h2> <h3 id="原生脚手架开发痛点分析"><a href="#原生脚手架开发痛点分析" class="header-anchor">#</a> 原生脚手架开发痛点分析</h3> <ul><li><p>痛点一：重复操作</p> <ul><li>多 Package 本地 link</li> <li>多 Package 依赖安装</li> <li>多 Package 单元测试</li> <li>多 Package 代码提交</li> <li>多 Package 代码发布</li></ul></li> <li><p>痛点二：版本一致性</p> <ul><li>发布时版本一致性</li> <li>发布后相互依赖版本升级</li></ul></li></ul> <blockquote><p>package 越多，管理复杂度越高</p></blockquote> <h3 id="lerna简介"><a href="#lerna简介" class="header-anchor">#</a> Lerna简介</h3> <blockquote><p>Lerna is a tool that optimizes the workflow around managing multi-package repositories with git and npm.</p> <p><strong>Lerna 是一个优化基于 git+npm 的多 package 项目的管理工具</strong></p></blockquote> <p><strong>优势</strong></p> <ul><li>大幅减少重复操作</li> <li>提升操作的标准化</li></ul> <blockquote><p>Lerna 是架构优化的产物，它揭示了一个架构真理：项目复杂度提升后，就需要对项目进行架构优化。架构优化的主要目标往往都是以效能为核心。</p></blockquote> <p><strong>官网</strong> <a href="https://lerna.js.org/" target="_blank" rel="noopener noreferrer">https://lerna.js.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>案例</strong>
使用 Lerna 管理的大型项目：</p> <ul><li>babel: <a href="https://github.com/babel/babel" target="_blank" rel="noopener noreferrer">https://github.com/babel/babel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>vue-cli: <a href="https://github.com/vuejs/vue-cli" target="_blank" rel="noopener noreferrer">https://github.com/vuejs/vue-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><s>create-react-app: <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener noreferrer">https://github.com/facebook/create-react-app<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></s></li></ul> <p><strong>lerna 开发脚手架流程（划重点）</strong></p> <p><img src="https://oss-1252175178.cos.ap-shanghai.myqcloud.com/%E6%85%95%E8%AF%BE%E7%BD%91%E6%9E%B6%E6%9E%84%E5%B8%88%E8%AF%BE%E7%A8%8B/lerna%20%E5%BC%80%E5%8F%91%E8%84%9A%E6%89%8B%E6%9E%B6%E6%B5%81%E7%A8%8B.png" alt=""></p> <h3 id="lerna-命令介绍"><a href="#lerna-命令介绍" class="header-anchor">#</a> Lerna 命令介绍</h3> <p>参考<a href="https://github.com/lerna/lerna" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>lerna init
<ul><li>描述：初始化 lerna 项目，添加 <code>lerna.json</code> 和 <code>packages</code> 目录</li> <li>示例：<code>lerna init</code></li></ul></li> <li>lerna create
<ul><li>描述：创建packages包</li> <li>示例：<code>lerna create core</code></li></ul></li> <li>lerna add
<ul><li>描述：对所有packages包，安装依赖，也可单独给某个packages包安装依赖</li> <li>示例：<code>lerna add lodash</code> <code>lerna add lodash packages/core/</code></li></ul></li> <li>lerna link
<ul><li>描述：自动添加packages包之间的软链（如果有依赖关系的话）</li> <li>示例：<code>lerna link</code></li></ul></li> <li>lerna clean
<ul><li>描述：对所有packages包，删除其中的 <code>node_modules</code></li> <li>示例：<code>lerna clean</code></li></ul></li> <li>lerna bootstrap
<ul><li>描述：给所有packages包，安装依赖，等同于cd 到每个包中，执行 <code>npm i</code></li> <li>示例：<code>lerna bootstrap</code></li></ul></li> <li>lerna exec
<ul><li>描述：对所有packages包，执行shell脚本，也可单独对某个包执行</li> <li>示例：
<ul><li><code>lerna exec -- rm -rf node_modules</code></li> <li><code>lerna exec --scope @jay-cli-dev/core -- rm -rf node_modules</code></li></ul></li></ul></li> <li>lerna run
<ul><li>描述：对所有packages包，运行某条命令</li> <li>示例：
<ul><li><code>lerna run test</code></li> <li><code>lerna run --scope @jay-cli-dev/utils test</code></li></ul></li></ul></li> <li>lerna version</li> <li>lerna diff</li> <li>lerna publish</li></ul> <h2 id="_6、lerna源码分析"><a href="#_6、lerna源码分析" class="header-anchor">#</a> 6、Lerna源码分析</h2> <h3 id="【讨论题】谈一谈-node和web的事件循环-eventloop-机制的异同"><a href="#【讨论题】谈一谈-node和web的事件循环-eventloop-机制的异同" class="header-anchor">#</a> 【讨论题】谈一谈 Node和Web的事件循环（EventLoop）机制的异同</h3> <ul><li>运行机制基本类似：
<ul><li>Web 的宏任务如 <code>setTimeout</code> 、<code>Ajax</code> ，主要交由对应的 Web API 处理，然后回调函数交由 V8 引擎处理</li> <li>Node 的宏任务如 <code>setTimeout</code>、<code>fs.readFile</code> 等 Node API 则主要是由跨平台异步IO库 <code>libuv</code> 处理，然后回调函数交由 V8 引擎处理</li></ul></li> <li>Node 中多了 process.nextTick 和 setImmediate，两者都提供的是异步能力
<ul><li>process.nextTick 是微任务</li> <li>setImmediate 是宏任务</li></ul></li> <li>Node.js的Event Loop跟浏览器的Event Loop不一样，他是分阶段的</li> <li><code>setImmediate</code> 和 <code>setTimeout(fn, 0)</code> 哪个回调先执行，需要看他们本身在哪个阶段注册的，如果在定时器回调或者I/O回调里面，<code>setImmediate</code> 肯定先执行。如果在最外层或者 <code>setImmediate</code> 回调里面，哪个先执行取决于当时机器状况。</li> <li><code>process.nextTick</code> 不在Event Loop的任何阶段，他是一个特殊API，他会立即执行，然后才会继续执行Event Loop</li></ul> <p>参考资料：</p> <ul><li><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="noopener noreferrer">JavaScript 运行机制详解：再谈Event Loop<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844904100195205133" target="_blank" rel="noopener noreferrer">setTimeout和setImmediate到底谁先执行，本文让你彻底理解Event Loop<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://nodejs.org/zh-cn/docs/guides/event-loop-timers-and-nexttick/" target="_blank" rel="noopener noreferrer">Node.js 事件循环，定时器和 process.nextTick()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/80458653" target="_blank" rel="noopener noreferrer">正确理解 Node.js 的 Event loop<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="_7、基于lerna重新设计jl"><a href="#_7、基于lerna重新设计jl" class="header-anchor">#</a> 7、基于Lerna重新设计JL</h2> <p>JL中新增：</p> <ul><li>熟悉Yargs脚手架开发框架</li> <li>熟悉多Package管理工具Lerna的使用方法和实现原理</li> <li>深入理解Node.js模块路径解析流程</li></ul> <h3 id="yargs"><a href="#yargs" class="header-anchor">#</a> yargs</h3> <ul><li>脚手架构成
<ul><li>bin：package.json中配置bin属性，npm link 本地安装</li> <li>command：命令</li> <li>options：参数（boolean/string/number）</li> <li>文件顶部增加 <code>#!/usr/bin/env node</code></li></ul></li> <li>脚手架-<strong>初始化</strong>流程
<ul><li>构造函数：Yargs()</li> <li>常用方法：
<ul><li><strong>Yargs.options</strong></li> <li>Yargs.option</li> <li><strong>Yargs.group</strong></li> <li>Yargs.demandCommand</li> <li>Yargs.recommendCommands</li> <li>Yargs.strict</li> <li><strong>Yargs.fail</strong></li> <li>Yargs.alias</li> <li>Yargs.wrap</li> <li>Yargs.epilogue</li></ul></li></ul></li> <li>脚手架-<strong>参数解析</strong>方法
<ul><li><strong>hideBin</strong>(process.argv) / Yargs.argv</li> <li><strong>Yargs.parse(argv, options)</strong></li></ul></li> <li>脚手架-<strong>命令注册</strong>方法
<ul><li><strong>Yargs.command(command, describe, builder, handler)</strong></li> <li><strong>Yargs.command({ command, describe, builder, handler })</strong></li></ul></li></ul> <h3 id="lerna"><a href="#lerna" class="header-anchor">#</a> Lerna</h3> <ul><li><p>Lerna 是基于 git+npm 的多package项目管理工具，提供了一系列的命令来降低多包项目的管理成本，如：</p> <ul><li>lerna init 初始化</li> <li>lerna create 创建包</li> <li>lerna add 安装依赖</li> <li>lerna exec 执行脚本</li> <li>lerna run 执行命令</li></ul></li> <li><p>实现原理</p> <ul><li>通过 import-local 优先调用本地 lerna 命令</li> <li>通过 Yargs 生成脚手架，先注册全局属性，再注册命令，最后通过 parse 方法解析参数</li> <li>lerna 命令注册时需要传入 builder 和 handler 两个方法，builder 方法用于注册命令专属的 options，handler 用来处理命令的业务逻辑</li> <li><strong>lerna 通过配置 npm 本地依赖的方式来进行本地开发</strong>，具体写法是在 package.json 的依赖中写入：<code>file:your-local-module-path</code> ，在 lerna publish 时会自动将该路径替换</li></ul></li></ul> <h3 id="node-js-模块路径解析流程"><a href="#node-js-模块路径解析流程" class="header-anchor">#</a> Node.js 模块路径解析流程</h3> <ul><li>Node.js 项目模块路径解析是通过 <code>require.resolve</code> 方法来实现的</li> <li><code>require.resolve</code> 就是通过 <code>Module._resolveFileName</code> 方法实现的</li> <li><code>require.resolve</code> 实现原理：
<ul><li><code>Module._resolveFileName</code>方法核心流程有 3 点：
<ul><li>判断是否为内置模块</li> <li>通过 <code>Module._resolveLookupPaths</code> 方法生成 node_modules 可能存在的路径</li> <li>通过 <code>Module._findPath</code> 查询模块的真实路径</li></ul></li> <li><code>Module._findPath</code> 核心流程有 4 点：
<ul><li>查询缓存（将 request 和 paths 通过 <code>\x00</code> 合并成 cacheKey）</li> <li>遍历 paths，将 path 与 request 组成文件路径 basePath</li> <li>如果 basePath 存在则调用 <code>fs.realPathSync</code> 获取文件真实路径</li> <li>将文件真实路径缓存到 <code>Module._pathCache</code>（key 就是前面生成的 cacheKey）</li></ul></li> <li><code>fs.realPathSync</code> 核心流程有 3 点：
<ul><li>查询缓存（缓存的 key 为 p，即 <code>Module._findPath</code> 中生成的文件路径）</li> <li>从左往右遍历路径字符串，查询到 <code>/</code> 时，拆分路径，判断该路径是否为软链接，如果是软链接则查询真实链接，并生成新路径 p，然后继续往后遍历，这里有 1 个细节需要特别注意：
<ul><li>遍历过程中生成的子路径 base 会缓存在 knownHard 和 cache 中，避免重复查询</li></ul></li> <li>遍历完成得到模块对应的真实路径，此时会将原始路径 original 作为 key，真实路径作为 value，保存到缓存中</li></ul></li></ul></li> <li><code>require.resolve.paths</code> 等价于 <code>Module._resolveLookupPaths</code>，该方法用于获取所有 node_modules 可能存在的路径</li> <li><code>require.resolve.paths</code> 实现原理：
<ul><li>如果路径为 <code>/</code>（根目录），直接返回 <code>['/node_modules']</code></li> <li>否则，将路径字符串从后往前遍历，查询到 <code>/</code> 时，拆分路径，在后面加上 node_modules，并传入一个 paths 数组，直至查询不到 <code>/</code> 后返回 paths 数组</li></ul></li></ul> <h2 id="本周作业"><a href="#本周作业" class="header-anchor">#</a> 本周作业</h2> <ul><li>标准：
<ul><li><p>理解脚手架的实现原理</p></li> <li><p>基于 <code>Lerna</code> 搭建自己的脚手架并发布到npm（功能不限）</p></li></ul></li> <li>进阶：
<ul><li>理解 <code>Yargs</code> 常用API和开发流程</li> <li>理解 <code>Lerna</code> 实现原理</li> <li>理解 <code>import-local</code> 实现原理，理解 <code>require.resolve</code> 实现原理</li></ul></li> <li>本周打卡：
<ul><li>作业地址：<a href="https://github.com/imooc-lego/students-learn-task" target="_blank" rel="noopener noreferrer">https://github.com/imooc-lego/students-learn-task<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>学员学习任务，作业、打卡、分享，请看 <a href="homework.imooc-lego.com">homework.imooc-lego.com</a></li></ul></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/21/2022, 2:34:36 AM</span></div></footer> <!----> </main></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.a2d0ac2d.js" defer></script><script src="/assets/js/2.6d2266aa.js" defer></script><script src="/assets/js/198.556c32f1.js" defer></script>
  </body>
</html>
